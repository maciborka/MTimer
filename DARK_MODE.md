# Поддержка Dark Mode в MacikTimer

## Внесенные изменения

### 1. Адаптивные системные цвета
Приложение теперь использует системные цвета macOS, которые автоматически адаптируются к светлой и тёмной теме:

- **Фон окна**: `NSColor.windowBackgroundColor()` - автоматический цвет фона
- **Карточка таймера**: `NSColor.controlBackgroundColor()` - светлая в light mode, тёмная в dark mode
- **Текст таймера**: `NSColor.labelColor()` - основной цвет текста
- **Вторичный текст**: `NSColor.secondaryLabelColor()` - для менее важной информации
- **Таблица**: `NSColor.controlBackgroundColor()` с адаптивным `NSColor.separatorColor()` для линий

### 2. Автоматическое обновление при смене темы
Добавлен observer на `NSSystemColorsDidChangeNotification`:
- Автоматически обновляет все цвета при переключении между светлой и тёмной темой
- Не требует перезапуска приложения
- Обновляет: карточку, текстовые поля, таблицу, фон окна

### 3. Сохраненные цвета
Следующие элементы сохраняют свои фиксированные цвета:
- **Синий хедер** - остается ярким во всех режимах
- **Розовая кнопка старт/стоп** - сохраняет фирменный цвет

## Тестирование

### Как проверить:
1. Запустите приложение
2. Откройте Системные настройки → Основные → Оформление
3. Переключите между "Светлое" и "Тёмное"
4. Приложение автоматически обновит цвета без перезапуска

### Ожидаемый результат:
- **Light Mode**: белая карточка, чёрный текст, светлый фон таблицы
- **Dark Mode**: тёмная карточка, белый текст, тёмный фон таблицы
- Все элементы читаемы в обоих режимах

## Технические детали

### Используемые API:
- `NSColor.labelColor()` - основной текст (черный/белый в зависимости от темы)
- `NSColor.secondaryLabelColor()` - вторичный текст (серый)
- `NSColor.controlBackgroundColor()` - фон элементов управления
- `NSColor.windowBackgroundColor()` - фон окна
- `NSColor.separatorColor()` - линии разделения

### NSNotificationCenter:
```python
NSNotificationCenter.defaultCenter().addObserver_selector_name_object_(
    self, 
    objc.selector(self.themeChanged_, signature=b"v@:@"),
    "NSSystemColorsDidChangeNotification",
    None
)
```

Обработчик `themeChanged_` вызывается при любом изменении системных цветов.

## Исправление проблем динамической смены темы

### Проблема:
При смене темы во время работы приложения некоторые элементы не обновлялись корректно:
- Поле ввода описания оставалось с неправильным цветом фона/текста
- Таблица инвертировалась, но кнопки оставались в старой теме

### Решение:
1. **Поле ввода** теперь явно использует:
   - `NSColor.textBackgroundColor()` для фона
   - `NSColor.textColor()` для текста
   - Обновляется в `themeChanged_`

2. **Принудительная перерисовка** всех элементов:
   ```python
   self.descriptionField.setNeedsDisplay_(True)
   self.timerCard.setNeedsDisplay_(True)
   self.tableView.setNeedsDisplay_(True)
   ```

3. **Обновление кнопок** - все кнопки фильтров и действий перерисовываются

### Полный список обновляемых элементов в themeChanged_:
- Фон окна
- Карточка таймера
- Поле ввода описания (фон + текст)
- Dropdown проектов
- Метки времени (таймер, общее, сегодня)
- Таблица сессий (фон, линии, текст)
- ScrollView
- Все кнопки (фильтры, продолжить, добавить проект)
